<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HPC Image Studio</title>
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono&display=swap"
    rel="stylesheet">
  <style>
    /* Estilos específicos para Demo de Imagen */
    .image-stage {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 20px 0;
      min-height: 200px;
    }

    .stage-box {
      border: 2px dashed #444;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      width: 30%;
      background: #1e1e1e;
      position: relative;
    }

    .stage-arrow {
      font-size: 2rem;
      color: #666;
    }

    .workers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .worker-node {
      background: #333;
      padding: 5px;
      font-size: 0.7rem;
      border-radius: 4px;
      border: 1px solid #555;
    }

    .img-preview {
      max-width: 100%;
      max-height: 200px;
      display: block;
      margin: 0 auto;
      border-radius: 4px;
    }

    #drop-zone {
      border: 2px dashed var(--primary);
      padding: 40px;
      cursor: pointer;
      transition: 0.3s;
    }

    #drop-zone:hover {
      background: #2A2A2A;
    }

    .stat-badge {
      font-family: 'JetBrains Mono', monospace;
      background: #000;
      padding: 4px 8px;
      border-radius: 4px;
      color: var(--success);
      font-size: 0.8rem;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div class="logo">HPC <span>DISTRIBUTED CUDA STUDIO</span></div>
      <div class="system-status">
        <div>WORKERS: <span id="online-nodes">0</span></div>
      </div>
    </header>

    <div class="main-content">

      <!-- UPLOAD SECTION -->
      <div class="card" id="upload-card">
        <h2>1. Subir Imagen Pesada</h2>
        <p style="color:#888; margin-bottom:15px">La imagen será dividida y procesada en paralelo por los workers
          disponibles.</p>

        <div id="drop-zone" onclick="document.getElementById('file-input').click()">
          <h3>Arrastra una imagen aquí o haz click</h3>
          <p style="font-size:0.8rem; color:#666">Soporta JPG, PNG (Max 10MB para demo)</p>
          <input type="file" id="file-input" hidden accept="image/*">
        </div>

        <div style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
          <label>Chunks (Partes):</label>
          <select id="chunk-select" style="padding: 5px; background: #333; color: #fff; border: 1px solid #555;">
            <option value="2">2 Partes</option>
            <option value="4">4 Partes</option>
            <option value="8">8 Partes</option>
          </select>
        </div>
      </div>

      <!-- VISUALIZATION SECTION -->
      <div class="card" id="process-card" style="display:none">
        <h2>2. Procesamiento Distribuido en Tiempo Real</h2>

        <div class="image-stage">
          <!-- INPUT -->
          <div class="stage-box">
            <h4>Original</h4>
            <img id="input-preview" class="img-preview" src="">
            <div style="font-size:0.7rem; color:#888; margin-top:5px" id="input-info"></div>
          </div>

          <div class="stage-arrow">➜</div>

          <!-- PROCESSING -->
          <div class="stage-box">
            <h4>Cluster (GPU Workers)</h4>
            <div id="cluster-status-text" style="color: var(--warning); margin-bottom: 10px;">En Espera...</div>
            <div class="workers-grid" id="workers-grid">
              <!-- Dinamico -->
            </div>
          </div>

          <div class="stage-arrow">➜</div>

          <!-- OUTPUT -->
          <div class="stage-box">
            <h4>Resultado (Filtro Sobel)</h4>
            <img id="output-preview" class="img-preview" style="display:none">
            <div id="output-loader" style="display:none">⏳ Uniendo...</div>
          </div>
        </div>

        <!-- STATS -->
        <div class="card" style="background:#222; border:1px solid #333">
          <h3>Estadísticas del Job</h3>
          <div class="stats-grid"
            style="display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; text-align:center">
            <div>
              <div style="color:#888; font-size:0.8rem">Tiempo Total GPU</div>
              <div class="stat-badge" id="stat-gpu">0.00s</div>
            </div>
            <div>
              <div style="color:#888; font-size:0.8rem">Workers Usados</div>
              <div class="stat-badge" id="stat-workers">0</div>
            </div>
            <div>
              <div style="color:#888; font-size:0.8rem">Estado</div>
              <div class="stat-badge" style="color:#fff" id="stat-status">-</div>
            </div>
          </div>

          <div style="margin-top: 15px;">
            <h4>Detalle por Chunk</h4>
            <table style="width:100%; font-size:0.8rem; text-align:left; color:#ccc">
              <thead>
                <tr>
                  <th>Chunk</th>
                  <th>Worker</th>
                  <th>GPU Time</th>
                  <th>Dispositivo</th>
                </tr>
              </thead>
              <tbody id="chunk-details-body"></tbody>
            </table>
          </div>

          <button class="btn-action" style="background:#444; margin-top:15px" onclick="location.reload()">NUEVA
            IMAGEN</button>
        </div>
      </div>

    </div>
  </div>
  <script src="/static/script.js"></script>
</body>

</html>